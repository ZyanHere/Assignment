(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5489],{10149:(e,t,s)=>{Promise.resolve().then(s.bind(s,27296))},27296:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(95155),r=s(5565),n=s(76046),o=s(12115),l=s(55037);function i(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)().get("flow"),[s,i]=(0,o.useState)(30),[c,d]=(0,o.useState)(!0),[u,h]=(0,o.useState)(["","","","","",""]),[m,p]=(0,o.useState)(!1),[f,x]=(0,o.useState)(!1),[g,y]=(0,o.useState)(""),[w,j]=(0,o.useState)(""),[v,b]=(0,o.useState)(""),[N,S]=(0,o.useState)(!1);(0,o.useEffect)(()=>{if(S(!0),"password-reset"===t){let t=localStorage.getItem("reset-userId"),s=localStorage.getItem("reset-email"),a=localStorage.getItem("reset-phone");if(!t){l.Ay.error("Reset session not found. Please try again."),e.push("/auth/forgotPassword");return}b(t),j(s||""),y(a||"")}else{let t=localStorage.getItem("signup-phone");if(!t){l.Ay.error("Phone number not found. Signup again."),e.push("/auth/signup");return}y(t)}},[t,e]);let I=g.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3"),O=async()=>{try{p(!0);let s=u.join("");if("password-reset"===t){let t=await fetch("http://localhost:4000/lmd/api/v1/auth/customer/verify-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:v,otp:s})}),a=await t.json();if(!t.ok)throw Error(a.message||"Invalid OTP");localStorage.setItem("reset-userId",v),l.Ay.success("OTP verified successfully!"),e.push("/auth/reset-password")}else{if(!(await fetch("http://localhost:4000/lmd/api/v1/auth/customer/verify-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:g,code:s})})).ok)throw Error("Invalid OTP");localStorage.removeItem("signup-phone"),e.push("/auth/success")}}catch(e){l.Ay.error(e.message),h(["","","","","",""])}finally{p(!1)}},P=async()=>{try{if(x(!0),"password-reset"===t){if(!(await fetch("http://localhost:4000/lmd/api/v1/auth/customer/resend-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:v})})).ok)throw Error("Failed to resend OTP");l.Ay.success("New OTP sent successfully!")}else{if(!(await fetch("/api/resend-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:g})})).ok)throw Error("Failed to resend OTP");l.Ay.success("New OTP sent successfully!")}h(["","","","","",""]),i(30),d(!0)}catch(e){l.Ay.error(e.message)}finally{x(!1)}};return((0,o.useEffect)(()=>{if(s>0){let e=setInterval(()=>{i(e=>e-1)},1e3);return()=>clearInterval(e)}d(!1)},[s]),N)?(0,a.jsxs)("div",{className:"flex min-h-screen bg-white",children:[(0,a.jsxs)("div",{className:"w-1/2 flex flex-col justify-center items-center bg-white px-10",children:[(0,a.jsx)("h2",{className:"text-[32px] font-normal text-black",children:"Verification"}),(0,a.jsxs)("p",{className:"text-[#828282] text-lg mt-[30px] text-center",children:["Enter the 6 digit code we sent to"," ","password-reset"===t?(0,a.jsxs)(a.Fragment,{children:[w&&(0,a.jsx)("span",{className:"font-medium",children:w}),w&&g&&(0,a.jsx)("span",{children:" and "}),g&&(0,a.jsx)("span",{className:"font-medium",children:I})]}):(0,a.jsx)("span",{className:"font-medium",children:I})]}),(0,a.jsx)("div",{className:"flex gap-4 my-8",children:u.map((e,t)=>(0,a.jsx)("input",{type:"text",inputMode:"numeric",maxLength:"1",value:e,onChange:e=>{let s=e.target.value.replace(/\D/g,""),a=[...u];if(a[t]=s,h(a),s&&t<5){var r;null===(r=document.getElementById("otp-".concat(t+1)))||void 0===r||r.focus()}},id:"otp-".concat(t),className:"w-12 h-12 text-xl text-center border-2 border-gray-300 rounded-lg focus:border-yellow-400 focus:ring-2 focus:ring-yellow-200",disabled:m},t))}),(0,a.jsx)("p",{className:"text-red-500 text-sm mt-[24px]",children:s>0?"00:".concat(s<10?"0".concat(s):s):null}),(0,a.jsx)("button",{onClick:O,disabled:m,className:"bg-yellow-400 font-medium text-[16px] w-[470px] py-3 mt-6 rounded-md hover:bg-yellow-500",children:m?"Verifying...":"VERIFY"}),(0,a.jsxs)("p",{className:"text-gray-500 text-sm mt-[33px]",children:["If you didn't receive a code!"," ",(0,a.jsx)("button",{onClick:P,className:"text-yellow-500 font-medium ".concat(c||f?"opacity-50 cursor-not-allowed":"hover:underline"),disabled:c||f,children:f?"Sending...":"Resend Code"})]})]}),(0,a.jsx)("div",{className:"hidden md:block w-1/2 shrink-0 rounded-l-[40px] relative",children:(0,a.jsx)(r.default,{src:"/auth-asset/hero-bg.png",alt:"Background",layout:"fill",objectFit:"cover",className:"rounded-l-[40px]"})})]}):null}function c(){return(0,a.jsx)("div",{className:"flex min-h-screen bg-white items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-400 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading verification..."})]})})}function d(){return(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)(c,{}),children:(0,a.jsx)(i,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[3738,5037,8441,6587,7358],()=>t(10149)),_N_E=e.O()}]);